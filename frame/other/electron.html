<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>背景 | Yolo</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="">
    <meta name="referrer" content="no-referrer">
    
    <link rel="preload" href="/blog/assets/css/0.styles.671fbdd0.css" as="style"><link rel="preload" href="/blog/assets/js/app.1b73a34e.js" as="script"><link rel="preload" href="/blog/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/blog/assets/js/9.d9b0c4aa.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.302da1cf.js"><link rel="prefetch" href="/blog/assets/js/11.49cb5a17.js"><link rel="prefetch" href="/blog/assets/js/12.cc05ffa9.js"><link rel="prefetch" href="/blog/assets/js/13.bc6a6d00.js"><link rel="prefetch" href="/blog/assets/js/14.49df6a75.js"><link rel="prefetch" href="/blog/assets/js/15.672d9069.js"><link rel="prefetch" href="/blog/assets/js/16.8a0222c4.js"><link rel="prefetch" href="/blog/assets/js/17.d45e1d15.js"><link rel="prefetch" href="/blog/assets/js/18.670357ed.js"><link rel="prefetch" href="/blog/assets/js/19.8df598c5.js"><link rel="prefetch" href="/blog/assets/js/20.4493dfa7.js"><link rel="prefetch" href="/blog/assets/js/21.29efc0e0.js"><link rel="prefetch" href="/blog/assets/js/22.dee43871.js"><link rel="prefetch" href="/blog/assets/js/23.12c95ddc.js"><link rel="prefetch" href="/blog/assets/js/24.fc85ab8b.js"><link rel="prefetch" href="/blog/assets/js/25.d2553c7d.js"><link rel="prefetch" href="/blog/assets/js/26.13251b4e.js"><link rel="prefetch" href="/blog/assets/js/27.704b5b19.js"><link rel="prefetch" href="/blog/assets/js/28.073d1c04.js"><link rel="prefetch" href="/blog/assets/js/29.82ede666.js"><link rel="prefetch" href="/blog/assets/js/3.420c64ab.js"><link rel="prefetch" href="/blog/assets/js/30.4e4e5bbf.js"><link rel="prefetch" href="/blog/assets/js/31.7ac6d421.js"><link rel="prefetch" href="/blog/assets/js/32.1a06c393.js"><link rel="prefetch" href="/blog/assets/js/33.7eb5807c.js"><link rel="prefetch" href="/blog/assets/js/34.44b85fd5.js"><link rel="prefetch" href="/blog/assets/js/35.3bcdab5e.js"><link rel="prefetch" href="/blog/assets/js/36.4b30ada3.js"><link rel="prefetch" href="/blog/assets/js/37.372eef9f.js"><link rel="prefetch" href="/blog/assets/js/38.eb5538b0.js"><link rel="prefetch" href="/blog/assets/js/39.615f174c.js"><link rel="prefetch" href="/blog/assets/js/4.d12742be.js"><link rel="prefetch" href="/blog/assets/js/40.b9313f5d.js"><link rel="prefetch" href="/blog/assets/js/41.9120b576.js"><link rel="prefetch" href="/blog/assets/js/42.f5a93f99.js"><link rel="prefetch" href="/blog/assets/js/43.12e57085.js"><link rel="prefetch" href="/blog/assets/js/44.5f50fa3f.js"><link rel="prefetch" href="/blog/assets/js/45.167bfe07.js"><link rel="prefetch" href="/blog/assets/js/46.2c467463.js"><link rel="prefetch" href="/blog/assets/js/47.d6509dea.js"><link rel="prefetch" href="/blog/assets/js/5.216cae74.js"><link rel="prefetch" href="/blog/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/blog/assets/js/7.9c9172a7.js"><link rel="prefetch" href="/blog/assets/js/8.c310a593.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.671fbdd0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Yolo</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/internet/计算机网络简史.html" class="nav-link">
  计网
</a></div><div class="nav-item"><a href="/blog/frame/" class="nav-link router-link-active">
  框架
</a></div><div class="nav-item"><a href="/blog/utils/源码阅读.html" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/blog/interview/vue/" class="nav-link">
  面试
</a></div> <a href="https://github.com/SetoInlandSea/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/internet/计算机网络简史.html" class="nav-link">
  计网
</a></div><div class="nav-item"><a href="/blog/frame/" class="nav-link router-link-active">
  框架
</a></div><div class="nav-item"><a href="/blog/utils/源码阅读.html" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/blog/interview/vue/" class="nav-link">
  面试
</a></div> <a href="https://github.com/SetoInlandSea/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>计网</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/internet/计算机网络简史.html" class="sidebar-link">计算机网络简史</a></li><li><a href="/blog/internet/OSI七层模型.html" class="sidebar-link">OSI七层模型</a></li><li><a href="/blog/internet/TCP_IP协议群.html" class="sidebar-link">TCP_IP协议群</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/frame/" aria-current="page" class="sidebar-link">首页</a></li><li><a href="/blog/frame/vue/vue3.0项目工程环境.html" class="sidebar-link">vue3.0项目工程环境</a></li><li><a href="/blog/frame/vue/vue3.html" class="sidebar-link">vue3</a></li><li><a href="/blog/frame/vue/大文件上传.html" class="sidebar-link">大文件上传</a></li><li><a href="/blog/frame/react/" class="sidebar-link">react</a></li><li><a href="/blog/frame/other/nuxt.html" class="sidebar-link">nuxt</a></li><li><a href="/blog/frame/other/electron.html" aria-current="page" class="active sidebar-link">electron</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frame/other/electron.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/blog/frame/other/electron.html#基本要求" class="sidebar-link">基本要求</a></li><li class="sidebar-sub-header"><a href="/blog/frame/other/electron.html#创建应用程序" class="sidebar-link">创建应用程序</a></li><li class="sidebar-sub-header"><a href="/blog/frame/other/electron.html#打包分发应用程序" class="sidebar-link">打包分发应用程序</a></li><li class="sidebar-sub-header"><a href="/blog/frame/other/electron.html#检测更新程序代码" class="sidebar-link">检测更新程序代码</a></li><li class="sidebar-sub-header"><a href="/blog/frame/other/electron.html#code-signing" class="sidebar-link">Code signing</a></li><li class="sidebar-sub-header"><a href="/blog/frame/other/electron.html#发布" class="sidebar-link">发布</a></li><li class="sidebar-sub-header"><a href="/blog/frame/other/electron.html#electron-vue3" class="sidebar-link">Electron + Vue3</a></li><li class="sidebar-sub-header"><a href="/blog/frame/other/electron.html#注意" class="sidebar-link">注意</a></li></ul></li><li><a href="/blog/frame/常用的方法.html" class="sidebar-link">常用的方法</a></li><li><a href="/blog/frame/字符串技巧.html" class="sidebar-link">字符串技巧</a></li><li><a href="/blog/frame/黑魔法.html" class="sidebar-link">黑魔法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/utils/源码阅读.html" class="sidebar-link">源码阅读</a></li><li><a href="/blog/utils/Chrome debugger.html" class="sidebar-link">Chrome debugger</a></li><li><a href="/blog/utils/git.html" class="sidebar-link">git</a></li><li><a href="/blog/utils/Chrome扩展插件.html" class="sidebar-link">Chrome扩展插件</a></li><li><a href="/blog/utils/npm发布.html" class="sidebar-link">npm发布</a></li><li><a href="/blog/utils/shell.html" class="sidebar-link">shell</a></li><li><a href="/blog/utils/前端工具.html" class="sidebar-link">前端工具</a></li><li><a href="/blog/utils/webpack.html" class="sidebar-link">webpack</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>产品</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分享</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <h3 id="图形用户界面"><a href="#图形用户界面" class="header-anchor">#</a> 图形用户界面</h3> <p>图形用户界面（Graphical User Interface，简称 GUI），是计算机图形学技术的一种，它一般由窗口、下拉菜单或者对话框等图形化的控件组成。用户通过点击菜单栏、按钮或者弹出对话框的形式来实现与机器的交互，GUI 的存在拉近了人与计算机的的距离，让人机交互的过程变得简单舒适、有温度。</p> <ul><li>当打开腾讯 QQ 后，在电脑桌面上会弹出 QQ 的登录界面，成功登录 QQ 后会显示 QQ 的主界面，这些都可以被称作图形用户界面</li> <li>再比如 Windows 操作系统的电脑桌面，本质上也是“图形用户界面”，只不过与 APP 相比，计算机用户界面更为复杂，在桌面上出现的任何一个弹出框都可以看做是一个“图形用户界面</li></ul> <h3 id="gui应用领域"><a href="#gui应用领域" class="header-anchor">#</a> GUI应用领域</h3> <p>GUI 的应用领域非常广泛，它不仅仅局限于软件产品（app）、计算机操作系统界面，还囊括了车载系统产品、智能家居、电子数码等产品，比如汽车中控台的显示屏界面，或者行车记录仪界面等等。</p> <h3 id="gui的优势"><a href="#gui的优势" class="header-anchor">#</a> GUI的优势</h3> <p>GUI 在互联网行业中有着举足轻重的地位，那些专门从事于界面开发的程序员被称为 GUI 开发工程师，如果在细分的话，可分为软件界面开发工程师和硬件界面开发工程师，它们统称为“界面开发程序员”。当然界面开发工作也需要配合其他岗位一起完成，比如前端 UI 工程师（User Interface Designer），他们主要负责界面的美化和设计等工作。</p> <p>与早期的命令行界面相比，图形界面对于用户更加友好，使用户在视觉上更容易接受。由于 GUI 直接与用户交互，因此它不仅仅是计算机中的一门技术，它还涉及了美学、行为学、心里学等许多领域的知识。因此在开发、设计一款 GUI 产品时，不能只局限于技术层面，而要对全局进行把控，最终使产品更符合人性化，从而提高用户的使用体验。</p> <h3 id="gui开发工具"><a href="#gui开发工具" class="header-anchor">#</a> GUI开发工具</h3> <p>目前市面上的 GUI 开发软件包有很多，其中多数使用 C/C++ 语言开发，其中较为流行的框架有 Qt 、GTK、wxWidgets、Electron、MFC/ATL（微软公司开发） 等。Electron 较为特殊，它是由 C/C++ 和 JS、TypeScript 开发而成，它通过 JavaScript、HTML 和 CSS 来构建跨平台的桌面应用程序。</p> <h3 id="为什么采用-c-c-库来开发-gui-软件包呢"><a href="#为什么采用-c-c-库来开发-gui-软件包呢" class="header-anchor">#</a> 为什么采用 C/C++ 库来开发 GUI 软件包呢？</h3> <p>这是因为相比于其他语言，C/C++ 更适合于开发 GUI 程序。我们知道 GUI 程序其实就是人和计算机的交互操作，因此程序的运行性能是考虑的第一要素，若性能不佳，将非常影响用户的体验。 C/C++ 作为执行效率仅次于汇编语言的编译型语言，用来开发 GUI 软件包在合适不过了。
除 C/C++ 之外，Python、Java、C# 等语言也提供了一些 GUI 开发软件包，如下所示：
Python GUI 工具：Tkinter、wxPython、PyQt、PyGTK、Pywin32 等；
Java GUI 工具：AWT、SWING、JavaFX 等；
C# GUI 工具： WinForm、WPF 等；
虽然上述语言的性能不及 C/C++，但是它们的开发效率很高，因此在性能要求不高的情况下，这些软件包也能够满足大多数用户的需求。大家要铭记，开发 GUI 程序的目的是为了实现人机交互，提升设备或者 APP 软件的易用性，这是 GUI 程序的初衷。</p> <h2 id="基本要求"><a href="#基本要求" class="header-anchor">#</a> 基本要求</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在使用Electron进行开发之前，您需要安装 Node.js。 我们建议您使用最新的LTS版本。</p></div> <blockquote><p>注意 因为 Electron 将 Node.js 嵌入到其二进制文件中，你应用运行时的 Node.js 版本与你系统中运行的 Node.js 版本无关。</p></blockquote> <h2 id="创建应用程序"><a href="#创建应用程序" class="header-anchor">#</a> 创建应用程序</h2> <h3 id="使用脚手架创建"><a href="#使用脚手架创建" class="header-anchor">#</a> 使用脚手架创建</h3> <div class="language- extra-class"><pre class="language-text"><code>mkdir my-electron-app &amp;&amp; cd my-electron-app
npm init
npm install --save-dev electron
</code></pre></div><p>init初始化命令会提示您在项目初始化配置中设置一些值 为本教程的目的，有几条规则需要遵循：</p> <ul><li>entry point 应为 main.js.</li> <li>author 与 description 可为任意值，但对于应用打包是必填项。</li></ul> <h3 id="运行主进程"><a href="#运行主进程" class="header-anchor">#</a> 运行主进程</h3> <p>任何 Electron 应用程序的入口都是 <strong>main</strong> 文件。 这个文件控制了主进程，它运行在一个完整的Node.js环境中，负责控制您应用的生命周期，显示原生界面，执行特殊操作并管理渲染器进程(稍后详细介绍)</p> <h3 id="创建页面"><a href="#创建页面" class="header-anchor">#</a> 创建页面</h3> <p>在可以为我们的应用创建窗口前，我们需要先创建加载进该窗口的内容。 在Electron中，各个窗口显示的内容可以是本地HTML文件，也可以是一个远程url。</p> <h3 id="在窗口中打开您的页面"><a href="#在窗口中打开您的页面" class="header-anchor">#</a> 在窗口中打开您的页面</h3> <p>将页面加载进应用窗口 需要两个模块</p> <ul><li><a href="https://www.electronjs.org/zh/docs/latest/api/app" target="_blank" rel="noopener noreferrer">app<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 模块，它控制应用程序的事件生命周期。</li> <li><a href="https://www.electronjs.org/zh/docs/latest/api/browser-window" target="_blank" rel="noopener noreferrer">BrowserWindow<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 模块，它创建和管理应用程序窗口。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// main.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> app<span class="token punctuation">,</span> BrowserWindow <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">createWindow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> win <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">800</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">600</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  win<span class="token punctuation">.</span><span class="token function">loadFile</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 Electron 中，只有在 app 模块的 <strong>ready</strong> 事件被激发后才能创建浏览器窗口。 您可以通过使用 app.whenReady() API来监听此事件。 在whenReady()成功后调用createWindow()。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">whenReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">createWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="管理窗口的生命周期"><a href="#管理窗口的生命周期" class="header-anchor">#</a> 管理窗口的生命周期</h3> <h4 id="关闭所有窗口时退出应用-windows-linux"><a href="#关闭所有窗口时退出应用-windows-linux" class="header-anchor">#</a> 关闭所有窗口时退出应用 (Windows &amp; Linux)</h4> <p>在Windows和Linux上，关闭所有窗口通常会完全退出一个应用程序</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 你需要监听 app 模块的 'window-all-closed' 事件。如果用户不是在 macOS(darwin) 上运行程序，则调用 app.quit()。</span>
app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'window-all-closed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>platform <span class="token operator">!==</span> <span class="token string">'darwin'</span><span class="token punctuation">)</span> app<span class="token punctuation">.</span><span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="如果没有窗口打开则打开一个窗口-macos"><a href="#如果没有窗口打开则打开一个窗口-macos" class="header-anchor">#</a> 如果没有窗口打开则打开一个窗口 (macOS)</h4> <p>当 Linux 和 Windows 应用在没有窗口打开时退出了，macOS 应用通常即使在没有打开任何窗口的情况下也继续运行，并且在没有窗口可用的情况下激活应用时会打开新的窗口。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/*
为了实现这一特性，监听 app 模块的 activate 事件。如果没有任何浏览器窗口是打开的，则调用 createWindow() 方法。
因为窗口无法在 ready 事件前创建，你应当在你的应用初始化后仅监听 activate 事件。 通过在您现有的 whenReady() 回调中附上您的事件监听器来完成这个操作。
*/</span>
app<span class="token punctuation">.</span><span class="token function">whenReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">createWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>BrowserWindow<span class="token punctuation">.</span><span class="token function">getAllWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">createWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="通过预加载脚本从渲染器访问node-js"><a href="#通过预加载脚本从渲染器访问node-js" class="header-anchor">#</a> 通过预加载脚本从渲染器访问Node.js</h3> <p>输出Electron的版本号和它的依赖项到你的web页面上</p> <p>在主进程通过Node的全局 process 对象访问这个信息是微不足道的。 然而，你不能直接在主进程中编辑DOM，因为它无法访问渲染器 文档 上下文。 它们存在于完全不同的进程
这是将 预加载 脚本连接到渲染器时派上用场的地方。 预加载脚本在渲染器进程加载之前加载，并有权访问两个 渲染器全局 (例如 window 和 document) 和 Node.js 环境</p> <h3 id="额外-将功能添加到您的网页内容"><a href="#额外-将功能添加到您的网页内容" class="header-anchor">#</a> 额外：将功能添加到您的网页内容</h3> <div class="language- extra-class"><pre class="language-text"><code>对于与您的网页内容的任何交互，您想要将脚本添加到您的渲染器进程中。 由于渲染器运行在正常的 Web 环境中，因此您可以在 index.html 文件关闭 &lt;/body&gt; 标签之前添加一个 &lt;script&gt; 标签，来包括您想要的任意脚本
</code></pre></div><p>总结</p> <ul><li><p>我们启动了一个Node.js程序，并将Electron添加为依赖。</p></li> <li><p>我们创建了一个 main.js 脚本来运行我们的主要进程，它控制我们的应用程序 并且在 Node.js 环境中运行。 在此脚本中， 我们使用 Electron 的 app 和 BrowserWindow 模块来创建一个浏览器窗口，在一个单独的进程(渲染器)中显示网页内容。</p></li> <li><p>为了访问渲染器中的Node.js的某些功能，我们在 BrowserWindow 的构造函数上附加了一个预加载脚本。</p></li></ul> <h2 id="打包分发应用程序"><a href="#打包分发应用程序" class="header-anchor">#</a> 打包分发应用程序</h2> <h3 id="update-electronjs-org"><a href="#update-electronjs-org" class="header-anchor">#</a> update.electronjs.org</h3> <p>Electron 官方在 <a href="https://update.electronjs.org" target="_blank" rel="noopener noreferrer">https://update.electronjs.org<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 上为<strong>开源应用程序</strong>提供了免费的自动更新服务。 使用它有以下几点要求：</p> <ul><li>你的应用在 macOS 或 Windows 上运行</li> <li>你的应用有一个公开的 GitHub 仓库</li> <li>应用程序需要发布到 GitHub releases 中</li> <li>应用程序需要完成 签名</li></ul> <h3 id="publisher"><a href="#publisher" class="header-anchor">#</a> Publisher</h3> <p>Electron Forge 的 <a href="https://www.electronforge.io/config/publishers" target="_blank" rel="noopener noreferrer">Publishers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 插件可以自动将打包的应用程序分发到各种来源</p> <h3 id="使用其他更新服务"><a href="#使用其他更新服务" class="header-anchor">#</a> 使用其他更新服务</h3> <p>开发一个私有的 Electron 应用程序
第一步：部署更新服务器
根据你的需要，你可以从下方选择：</p> <ul><li>Hazel——用于私人或开源应用的更新服务器，可在 Vercel 上免费部署。 它从GitHub Releases中拉取更新文件，并且利用 GitHub CDN 的强大性能。</li> <li>Nuts－同样使用GitHub Releases, 但得在磁盘上缓存应用程序更新并支持私有存储库.</li> <li>electron-release-server – 提供一个用于处理发布的仪表板，并且不需要在GitHub上发布发布。</li> <li>Nucleus – 一个由Atlassian维护的 Electron 应用程序的完整更新服务器。 支持多种应用程序和渠道; 使用静态文件存储来降低服务器成本.
一旦您部署了更新服务器，您就可以编写您的应用代码，以使用 Electron 的 autoUpdater 模块接收和应用更新。</li></ul> <p>第二步：在你的应用程序上接收更新
首先，在您的主进程代码中导入所需模块</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> app<span class="token punctuation">,</span> autoUpdater<span class="token punctuation">,</span> dialog <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token string">'https://your-deployment-url.com'</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>server<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/update/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span>platform<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>app<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token comment">// 构建更新服务器的 URL 并通知 autoUpdater：</span>
autoUpdater<span class="token punctuation">.</span><span class="token function">setFeedURL</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  autoUpdater<span class="token punctuation">.</span><span class="token function">checkForUpdates</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 每分钟检查一次</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">60000</span><span class="token punctuation">)</span>
</code></pre></div><p>第三步：当更新可用时通知用户</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>autoUpdater<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'update-downloaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> releaseNotes<span class="token punctuation">,</span> releaseName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dialogOpts <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'info'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">buttons</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Restart'</span><span class="token punctuation">,</span> <span class="token string">'Later'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'Application Update'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> process<span class="token punctuation">.</span>platform <span class="token operator">===</span> <span class="token string">'win32'</span> <span class="token operator">?</span> releaseNotes <span class="token operator">:</span> releaseName<span class="token punctuation">,</span>
    <span class="token literal-property property">detail</span><span class="token operator">:</span>
      <span class="token string">'A new version has been downloaded. Restart the application to apply the updates.'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  dialog<span class="token punctuation">.</span><span class="token function">showMessageBox</span><span class="token punctuation">(</span>dialogOpts<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">returnValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>returnValue<span class="token punctuation">.</span>response <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> autoUpdater<span class="token punctuation">.</span><span class="token function">quitAndInstall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 错误处理 错误日志输出到stderr</span>
autoUpdater<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'There was a problem updating the application'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="检测更新程序代码"><a href="#检测更新程序代码" class="header-anchor">#</a> 检测更新程序代码</h2> <p>至此我们有了一个通过 GitHub 发布的功能性发布系统， 我们现在需要告诉我们的 Electron 应用来下载更新，而且是每当新版本出现时都需要更新。 Electron 应用通过 <a href="https://www.electronjs.org/zh/docs/latest/api/auto-updater" target="_blank" rel="noopener noreferrer">autoUpdater<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 模块来实现此功能, 此模块可以从更新服务源中读取信息, 并检查是否有一个新版本可供下载.</p> <h2 id="code-signing"><a href="#code-signing" class="header-anchor">#</a> Code signing</h2> <p>代码签名是一种用来证明应用是由你创建的一种安全技术。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在Windows系统中，如果程序没有代码签名证书，或者代码签名授信级别较低时，系统同样会将其列为可信程序，只是当用户运行该应用时，系统会显示安全提示。</p></div> <p>默认情况下，Windows 和 macOS 都会禁止未签名的应用的下载或运行</p> <h3 id="认证"><a href="#认证" class="header-anchor">#</a> 认证</h3> <h2 id="发布"><a href="#发布" class="header-anchor">#</a> 发布</h2> <p>应用上传到各个操作系统的应用分发平台（如 App Store）</p> <h2 id="electron-vue3"><a href="#electron-vue3" class="header-anchor">#</a> Electron + Vue3</h2> <p>Vue CLI Plugin Electron Builder基于Vue Cli的，因此项目的搭建非常方便
::: info
vue-cli-plugin-electron-builder打包构建实际上用的是<a href="https://www.electron.build/" target="_blank" rel="noopener noreferrer">electron-builder<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
不用再去安装一遍electron-builder了
:::</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm i @vue<span class="token operator">/</span>cli <span class="token operator">-</span>g·············
vue create electron<span class="token operator">-</span>app
</code></pre></div><p>Vue CLI Plugin Electron Builder</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>vue add electron<span class="token operator">-</span>builder
</code></pre></div><p>启用项目</p> <div class="language- extra-class"><pre class="language-text"><code>npm run electron:serve
</code></pre></div><p>electron主进程的代码放在了<strong>background.js</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">electronBuilder</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">builderOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// options placed here will be merged with default configuration and passed to electron-builder</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="注意"><a href="#注意" class="header-anchor">#</a> 注意</h2> <h3 id="打包因图标太小报错"><a href="#打包因图标太小报错" class="header-anchor">#</a> 打包因图标太小报错</h3> <p>报错 <code>ERR_ICON_TOO_SMALL</code>
win图标最小为256<em>256
mac图标最小为512</em>512
electron-builder要求icon需要放到buildResources目录中（默认为build）中，也就是dist目录</p> <h3 id="m1-exit-code-enoent-spawn-usr-bin-python-enoent"><a href="#m1-exit-code-enoent-spawn-usr-bin-python-enoent" class="header-anchor">#</a> M1 Exit code: ENOENT. spawn /usr/bin/python ENOENT</h3> <p>原因
builder-util正在尝试调用 python，因为该包dmg-builder使用
python 脚本您可以设置环境变量PYTHON_PATH以覆盖默认值/usr/bin/python，但是：
dmg-builder使用仅在 Python 2 中内置的reload模块</p> <p>方法一
安装python 2.7，并获取安装路径（例如：/XXX/versions/2.7/bin/python）；
打开“YourProjectPath/node_modules/dmg-builder/out/dmg.js”，找到“/usr/bin/python”，替换为“/XXX/versions/2.7/bin/python”</p> <p>方法二</p> <ol><li>场景1 不使用vue-cli-plugin-electron-builder</li></ol> <ul><li>可以直接升级electron-builder@23.0.3</li></ul> <ol start="2"><li>场景2 使用vue-cli-plugin-electron-builder
内部的electron-builder版本依旧很低</li></ol> <ul><li>可以通过yarn <a href="https://classic.yarnpkg.com/lang/en/docs/selective-version-resolutions/" target="_blank" rel="noopener noreferrer">选择性依赖<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> / 或者npm overrides 解决方案</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>为什么需要选择性依赖？
可能依赖于一个不经常更新的包，而这又依赖于另一个获得重要升级的包</p></div> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 如果你使用 yarn，安装 python2.7.18 并修复 python 的路径后，</span>
<span class="token comment">// 你可以在 package.json 中添加这段代码来修复它</span>
<span class="token string-property property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token operator">...</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token string-property property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token operator">...</span>
<span class="token punctuation">}</span>
<span class="token string-property property">&quot;resolutions&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&quot;vue-cli-plugin-electron-builder/electron-builder&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^23.0.3&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>如果你是用npm
npm <span class="token operator">&gt;=</span> v8
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;vue-cli-plugin-electron-builder&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.1.1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;overrides&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;vue-cli-plugin-electron-builder&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;electron-builder&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^23.0.3&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

rm <span class="token operator">-</span>rf node_modules
rm <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
npm install

</code></pre></div><h3 id="error-error-0308010c-digital-envelope-routines-unsupported"><a href="#error-error-0308010c-digital-envelope-routines-unsupported" class="header-anchor">#</a> Error: error:0308010C:digital envelope routines::unsupported</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// nodejs v17+</span>
⠋  Bundling main process<span class="token operator">...</span>node<span class="token operator">:</span>internal<span class="token operator">/</span>crypto<span class="token operator">/</span>hash<span class="token operator">:</span><span class="token number">67</span>
  <span class="token keyword">this</span><span class="token punctuation">[</span>kHandle<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">_Hash</span><span class="token punctuation">(</span>algorithm<span class="token punctuation">,</span> xofLen<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token operator">^</span>

<span class="token literal-property property">Error</span><span class="token operator">:</span> error<span class="token operator">:</span>0308010C<span class="token operator">:</span>digital envelope routines<span class="token operator">:</span><span class="token operator">:</span>unsupported
  at module<span class="token punctuation">.</span><span class="token function">exports</span> <span class="token punctuation">(</span><span class="token operator">/</span>Users<span class="token operator">/</span>zhangfuling<span class="token operator">/</span>Desktop<span class="token operator">/</span>project<span class="token operator">/</span>electron<span class="token operator">-</span>app<span class="token operator">/</span>node_modules<span class="token operator">/</span>vue<span class="token operator">-</span>cli<span class="token operator">-</span>plugin<span class="token operator">-</span>electron<span class="token operator">-</span>builder<span class="token operator">/</span>node_modules<span class="token operator">/</span>webpack<span class="token operator">/</span>lib<span class="token operator">/</span>util<span class="token operator">/</span>createHash<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">135</span><span class="token operator">:</span><span class="token number">53</span><span class="token punctuation">)</span>

</code></pre></div><ol><li>原因</li></ol> <ul><li>nodejs 17+支持OpenSSL3.0 MD4这样的算法已经被降级了</li> <li>webpack使用crypto.createHash()模块的方法创建哈希。这个方法只能使用当前node版本对应的OpenSSL版本可用和支持的算法创建哈希。
<a href="https://github.com/webpack/webpack/blob/main/lib/util/createHash.js" target="_blank" rel="noopener noreferrer">webpack源码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * Creates a hash by name or function
 * @param {string | typeof Hash} algorithm the algorithm name or a constructor creating a hash
 * @returns {Hash} the hash
 */</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">algorithm</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> algorithm <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BulkUpdateDecorator</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">algorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>algorithm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO add non-cryptographic algorithm here</span>
    <span class="token keyword">case</span> <span class="token string">&quot;debug&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DebugHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;xxhash64&quot;</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>createXXHash64 <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        createXXHash64 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./hash/xxhash64&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>BatchedHash <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          BatchedHash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./hash/BatchedHash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BatchedHash</span><span class="token punctuation">(</span><span class="token function">createXXHash64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;md4&quot;</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>createMd4 <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        createMd4 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./hash/md4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>BatchedHash <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          BatchedHash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./hash/BatchedHash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BatchedHash</span><span class="token punctuation">(</span><span class="token function">createMd4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;native-md4&quot;</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>crypto <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;crypto&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BulkUpdateDecorator</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> crypto<span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">&quot;md4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;md4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>crypto <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;crypto&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BulkUpdateDecorator</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> crypto<span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span>algorithm<span class="token punctuation">)</span><span class="token punctuation">,</span>
        algorithm
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><ol start="2"><li>解决方法</li></ol> <ul><li>nodejs降级到16或者更低版本</li> <li>将--openssl-legacy-provider传递给webpack或者基于webpack的cli工具</li> <li>设置环境变量 NODE_OPTIONS</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>--openssl-legacy-provider 这个标志可以告诉node恢复到openssl3.0的旧提供程序，
允许webpack使用md4这种传统加密算法</p></div> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// macos Unix</span>
<span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;export NODE_OPTIONS=--openssl-legacy-provider &amp;&amp; vue-cli-service serve&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;export NODE_OPTIONS=--openssl-legacy-provider &amp;&amp; vue-cli-service build&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;export NODE_OPTIONS=--openssl-legacy-provider &amp;&amp; vue-cli-service lint&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// windows</span>
<span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;set NODE_OPTIONS=--openssl-legacy-provider &amp;&amp; vue-cli-service serve&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;set NODE_OPTIONS=--openssl-legacy-provider &amp;&amp; vue-cli-service build&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;set NODE_OPTIONS=--openssl-legacy-provider &amp;&amp; vue-cli-service lint&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="part-download-request-failed-with-status-code-401"><a href="#part-download-request-failed-with-status-code-401" class="header-anchor">#</a> part download request failed with status code 401</h3> <p>在macos上打包exe</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  • downloading     url<span class="token operator">=</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>electron<span class="token operator">-</span>userland<span class="token operator">/</span>electron<span class="token operator">-</span>builder<span class="token operator">-</span>binaries<span class="token operator">/</span>releases<span class="token operator">/</span>download<span class="token operator">/</span>winCodeSign<span class="token operator">-</span><span class="token number">2.6</span><span class="token number">.0</span><span class="token operator">/</span>winCodeSign<span class="token operator">-</span><span class="token number">2.6</span><span class="token number">.0</span><span class="token punctuation">.</span>7z size<span class="token operator">=</span><span class="token number">5.6</span> <span class="token constant">MB</span> parts<span class="token operator">=</span><span class="token number">1</span>
  • retrying        attempt<span class="token operator">=</span><span class="token number">1</span>
  • retrying        attempt<span class="token operator">=</span><span class="token number">2</span>
  • retrying        attempt<span class="token operator">=</span><span class="token number">3</span>
  ⨯ part download request failed <span class="token keyword">with</span> status code <span class="token number">401</span>
github<span class="token punctuation">.</span>com<span class="token operator">/</span>develar<span class="token operator">/</span>app<span class="token operator">-</span>builder<span class="token operator">/</span>pkg<span class="token operator">/</span>download<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>Part<span class="token punctuation">)</span><span class="token punctuation">.</span>doRequest
	<span class="token operator">/</span>Volumes<span class="token operator">/</span>data<span class="token operator">/</span>Documents<span class="token operator">/</span>app<span class="token operator">-</span>builder<span class="token operator">/</span>pkg<span class="token operator">/</span>download<span class="token operator">/</span>Part<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">126</span>
github<span class="token punctuation">.</span>com<span class="token operator">/</span>develar<span class="token operator">/</span>app<span class="token operator">-</span>builder<span class="token operator">/</span>pkg<span class="token operator">/</span>download<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>Part<span class="token punctuation">)</span><span class="token punctuation">.</span>download
	<span class="token operator">/</span>Volumes<span class="token operator">/</span>data<span class="token operator">/</span>Documents<span class="token operator">/</span>app<span class="token operator">-</span>builder<span class="token operator">/</span>pkg<span class="token operator">/</span>download<span class="token operator">/</span>Part<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">67</span>
github<span class="token punctuation">.</span>com<span class="token operator">/</span>develar<span class="token operator">/</span>app<span class="token operator">-</span>builder<span class="token operator">/</span>pkg<span class="token operator">/</span>download<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>Downloader<span class="token punctuation">)</span><span class="token punctuation">.</span>DownloadResolved<span class="token punctuation">.</span>func1<span class="token punctuation">.</span><span class="token number">1</span>
	<span class="token operator">/</span>Volumes<span class="token operator">/</span>data<span class="token operator">/</span>Documents<span class="token operator">/</span>app<span class="token operator">-</span>builder<span class="token operator">/</span>pkg<span class="token operator">/</span>download<span class="token operator">/</span>downloader<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">155</span>
github<span class="token punctuation">.</span>com<span class="token operator">/</span>develar<span class="token operator">/</span>app<span class="token operator">-</span>builder<span class="token operator">/</span>pkg<span class="token operator">/</span>util<span class="token punctuation">.</span>MapAsyncConcurrency<span class="token punctuation">.</span>func2
	<span class="token operator">/</span>Volumes<span class="token operator">/</span>data<span class="token operator">/</span>Documents<span class="token operator">/</span>app<span class="token operator">-</span>builder<span class="token operator">/</span>pkg<span class="token operator">/</span>util<span class="token operator">/</span>async<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">68</span>
runtime<span class="token punctuation">.</span>goexit
	<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>Cellar<span class="token operator">/</span>go<span class="token operator">/</span><span class="token number">1.17</span><span class="token operator">/</span>libexec<span class="token operator">/</span>src<span class="token operator">/</span>runtime<span class="token operator">/</span>asm_arm64<span class="token punctuation">.</span>s<span class="token operator">:</span><span class="token number">1133</span>
</code></pre></div><p>原因
网络问题 在macos上打包exe 包体积太大
解决方案</p> <div class="language- extra-class"><pre class="language-text"><code>cat .npmrc
registry=https://registry.npm.taobao.org/
electron-builder-binaries_mirror=https://registry.npmmirror.com/-/binary/electron-builder-binaries/
electron-mirror=http://npm.taobao.org/mirrors/electron/
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/SetoInlandSea/blog/edit/docs/docs/frame/other/electron.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/frame/other/nuxt.html" class="prev">
        nuxt
      </a></span> <span class="next"><a href="/blog/frame/常用的方法.html">
        常用的方法
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.1b73a34e.js" defer></script><script src="/blog/assets/js/2.733019b2.js" defer></script><script src="/blog/assets/js/9.d9b0c4aa.js" defer></script>
  </body>
</html>
